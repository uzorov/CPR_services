(function(){"use strict";var t={9503:function(t,e,s){var a=s(5471),i=s(8505),o=s(7776),r=s(6074),n=s(7954),l=s(7410),c=s(1735),d=function(){var t=this,e=t._self._c;return e(i.A,[e(o.A,{attrs:{app:""}},[e(c.sw,[e(r.A,{staticClass:"ml-2 mr-1"},[e("img",{attrs:{src:"https://nvpsy.ru/img/index/6.png",alt:"Logo"}})]),t._v(" Цифровой помощник руководителя ")],1),e(l.A),t.isLoggedIn?e("UserMenu",{attrs:{user:t.user},on:{logout:t.handleLogout}}):t._e()],1),e(n.A,[t.isLoggedIn?e("TaskList"):e("LoginForm",{on:{"login-success":t.handleLoginSuccess}}),e("notifications",{attrs:{group:"foo",position:"top right"}})],1)],1)},u=[],p=s(375),h=s(9456),g=s(2987),f=s(1075),_=s(1647),y=s(6520),k=function(){var t=this,e=t._self._c;return e(y.A,{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:a}){return[e(p.A,t._g(t._b({staticClass:"pa-6",attrs:{text:"",rounded:""}},"v-btn",a,!1),s),[e("div",{attrs:{align:"left"}},[e("span",{staticClass:"font-weight-bold dark-grey--text"},[t._v(t._s(t.user.name))]),e("br"),e("span",{staticClass:"text-caption grey--text"},[t._v(t._s(t.user.localized_role))])]),e(r.A,{staticClass:"ml-2",attrs:{size:"40"}},[e(h.A,{attrs:{"x-large":"",color:"dark-grey"}},[t._v("mdi-account-tie")])],1)],1)]}}])},[e(g.A,[e(f.A,[e(_.pr,[e(_.UZ,[t._v(t._s(t.user.name))]),e(_.w,[t._v(t._s(t.user.localized_role))])],1)],1),e(f.A,{on:{click:t.logout}},[e(_.UZ,[t._v("Выйти")])],1)],1)],1)},m=[],A={props:{user:Object},methods:{logout(){this.$emit("logout")}}},v=A,T=s(1656),b=(0,T.A)(v,k,m,!1,null,"6b85b80c",null),D=b.exports,E=s(1526),U=s(6278),x=s(2822),$=s(8461),w=s(4519),S=s(9366),O=s(2585),R=s(8412),L=s(8233),C=s(9940),P=function(){var t=this,e=t._self._c;return e(U.A,[e(R.A,{staticClass:"mb-2",attrs:{justify:"end"}},[e(E.A,{attrs:{cols:"auto"}},["Руководитель"===t.userRole?e(p.A,{attrs:{color:"primary",outlined:""},on:{click:function(e){return t.openTaskForm(!1,null)}}},[e(h.A,{attrs:{left:""}},[t._v("mdi-file-plus")]),t._v(" Добавить поручение ")],1):t._e()],1)],1),e(R.A,{staticClass:"mb-4"},[e(E.A,{attrs:{cols:"12",md:"4"}},[e(L.A,{attrs:{items:t.statusOptions,label:"Фильтр по статусу",clearable:""},model:{value:t.filterStatus,callback:function(e){t.filterStatus=e},expression:"filterStatus"}})],1),e(E.A,{attrs:{cols:"12",md:"4"}},[e(L.A,{attrs:{items:t.priorityOptions,label:"Фильтр по приоритету",clearable:""},model:{value:t.filterPriority,callback:function(e){t.filterPriority=e},expression:"filterPriority"}})],1),e(E.A,{attrs:{cols:"12",md:"4"}},[e(C.A,{attrs:{label:"Поиск по заголовку",clearable:"","append-icon":"mdi-magnify"},model:{value:t.searchQuery,callback:function(e){t.searchQuery=e},expression:"searchQuery"}})],1)],1),e(S.A,[e(x.A,[e(w.A,[t._v(" Поручения, назначенные на меня ("+t._s(t.isLoading?"Загрузка...":t.filteredAssignedTasks.length)+") "),t.isLoading?e("span",{staticClass:"ml-2"},[e(O.A,{attrs:{indeterminate:"",size:"18",color:"primary"}})],1):t._e()]),e($.A,[t.isLoading?e(R.A,[e(E.A,{attrs:{cols:"12"}},[e("p",[t._v("Загрузка...")])])],1):e(R.A,t._l(t.filteredAssignedTasks,(function(s){return e(E.A,{key:s.id,attrs:{cols:"12",md:"4"}},[e("TaskCard",{attrs:{task:s,users:t.users},on:{"edit-task":function(e){return t.openTaskForm(!0,s)},"delete-task":t.deleteTask,"open-readonly-task":function(e){return t.openTaskForm(!1,s,!0)}}})],1)})),1)],1)],1),e(x.A,[e(w.A,[t._v(" Поручения, созданные мной ("+t._s(t.isLoading?"Загрузка...":t.filteredCreatedTasks.length)+") "),t.isLoading?e("span",{staticClass:"ml-2"},[e(O.A,{attrs:{indeterminate:"",size:"18",color:"primary"}})],1):t._e()]),e($.A,[t.isLoading?e(R.A,[e(E.A,{attrs:{cols:"12"}},[e("p",[t._v("Загрузка...")])])],1):e(R.A,t._l(t.filteredCreatedTasks,(function(s){return e(E.A,{key:s.id,attrs:{cols:"12",md:"4"}},[e("TaskCard",{attrs:{task:s,users:t.users},on:{"edit-task":function(e){return t.openTaskForm(!0,s)},"delete-task":t.deleteTask,"open-readonly-task":function(e){return t.openTaskForm(!1,s,!0)}}})],1)})),1)],1)],1)],1),e("TaskForm",{attrs:{isDialogOpen:t.isTaskFormOpen,isReadonly:t.isFormReadonly,isEditMode:t.isEditMode,task:t.currentTask},on:{"save-task":t.saveTask,"update:isDialogOpen":t.updateTaskFormOpen}})],1)},B=[],N=(s(4114),s(1689)),j=s(8834),V=s(4089),I=function(){var t=this,e=t._self._c;return e(N.A,{staticClass:"task-card"},[e(j.ri,[e("div",{staticClass:"title-container"},[t._v(" "+t._s(t.task.subject)+" "),e("div",{staticClass:"corner-icon-buttons"},[e(p.A,{attrs:{icon:""},on:{click:function(e){return t.$emit("open-readonly-task",t.task)}}},[e(h.A,[t._v("mdi-eye")])],1),e(p.A,{attrs:{icon:""},on:{click:t.downloadTask}},[e(h.A,[t._v("mdi-download")])],1)],1)])]),e(j.ZR,[e("div",[t.isTaskNotAssignedToCurrentUser?t._e():e(L.A,{attrs:{items:t.statuses,label:"Статус"},on:{change:t.updateStatus},model:{value:t.selectedStatus,callback:function(e){t.selectedStatus=e},expression:"selectedStatus"}})],1),e("div",{class:t.statusClass},[t._v("Статус: "+t._s(t.selectedStatus))]),e("div",{staticClass:"font-weight-bold"},[t._v(" Приоритет: "+t._s(t.task.priority)+" "),e(h.A,{attrs:{color:t.priorityIcon.color}},[t._v(t._s(t.priorityIcon.icon))])],1),t.assignedToUser?e("div",[t._v("Исполнитель: "+t._s(t.assignedToUser.name))]):t._e(),t.assignedByUser?e("div",[t._v("Инициатор: "+t._s(t.assignedByUser.name))]):t._e(),e("div",[t._v("Поручение создано: "+t._s(t.task.registration_date))])]),e(j.OQ,[t._v(" "+t._s(t.task.description.length>30?t.task.description.slice(0,30)+"...":t.task.description)+" ")]),e(j.SL,[t.isTaskNotAssignedToCurrentUser?e(p.A,{attrs:{color:"primary",small:""},on:{click:function(e){return t.$emit("edit-task",t.task)}}},[t._v("Редактировать")]):t._e(),t.isTaskNotAssignedToCurrentUser?e(p.A,{attrs:{color:"error",small:""},on:{click:t.openDeleteDialog}},[e(h.A,[t._v("mdi-delete")])],1):t._e()],1),e(V.A,{attrs:{"max-width":"400px"},model:{value:t.isDeleteDialogOpen,callback:function(e){t.isDeleteDialogOpen=e},expression:"isDeleteDialogOpen"}},[e(N.A,[e(j.ri,{staticClass:"headline"},[t._v("Подтверждение удаления")]),e(j.OQ,[t._v("Вы уверены, что хотите удалить поручение?")]),e(j.SL,[e(l.A),e(p.A,{attrs:{color:"blue darken-1",text:""},on:{click:t.closeDeleteDialog}},[t._v("Отмена")]),e(p.A,{attrs:{color:"red darken-1",text:""},on:{click:t.confirmDelete}},[t._v("Удалить")])],1)],1)],1)],1)},F=[],z=(s(4603),s(7566),s(8721),s(4335)),M={props:{task:{type:Object,required:!0},users:{type:Array,required:!0}},data(){return{assignedToUser:null,assignedByUser:null,isTaskNotAssignedToCurrentUser:!0,isDeleteDialogOpen:!1,selectedStatus:this.task.status,statuses:["В обработке","Завершено","Отменено"]}},mounted(){this.findAssignedUser()},methods:{async downloadTask(){try{const t=localStorage.getItem("access_token");if(!t)throw new Error("Token not found in localStorage");const e=await z.A.get(`${{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_GATEWAY_URL}/documents-api/${this.task.id}/generate-word-document`,{responseType:"blob",headers:{Authorization:`Bearer ${t}`}}),s=e.headers["content-type"];if("application/vnd.openxmlformats-officedocument.wordprocessingml.document"!==s)throw new Error(`Неправильный тип содержимого: ${s}`);const a=window.URL.createObjectURL(new Blob([e.data],{type:s})),i=document.createElement("a");i.href=a,i.setAttribute("download",`task_${this.task.id}.docx`),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(a)}catch(t){console.error("Ошибка при загрузке файла:",t)}},findAssignedUser(){if(this.task.responsible_employee_id){const t=localStorage.getItem("user_id");this.assignedToUser=this.users.find((t=>t.id===this.task.responsible_employee_id)),t==this.assignedToUser.id&&(this.isTaskNotAssignedToCurrentUser=!1);const e=this.users.find((t=>t.id===this.task.author_id));t==this.assignedToUser.id&&t==e.id&&(this.isTaskNotAssignedToCurrentUser=!0),e&&(this.assignedByUser=e)}},openDeleteDialog(){this.isDeleteDialogOpen=!0},closeDeleteDialog(){this.isDeleteDialogOpen=!1},confirmDelete(){this.$emit("delete-task",this.task),this.closeDeleteDialog()},async updateStatus(){try{const t=localStorage.getItem("access_token"),e=`${{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_GATEWAY_URL}/documents-api/${this.task.id}`,s={file_id:this.task.file_id||null,subject:this.task.subject||"",description:this.task.description||"",status:this.selectedStatus||"",priority:this.task.priority||"",author_id:this.task.author_id||"",responsible_employee_id:this.assignedToUser.id||"",registration_date:this.task.registration_date||(new Date).toISOString()},a=await z.A.put(e,s,{headers:{Authorization:`Bearer ${t}`}});200===a.status?(this.$emit("status-updated",this.task.id,this.selectedStatus),this.$notify({group:"foo",type:"success",text:"Статус обновлен"})):this.$notify({group:"foo",type:"error",text:"Не удалось обновить статус"})}catch(t){this.$notify({group:"foo",type:"error",text:"Не удалось обновить статус"})}}},computed:{statusClass(){return"В обработке"===this.selectedStatus?"status-in-progress":"Завершено"===this.selectedStatus?"status-completed":"Отменено"===this.selectedStatus?"status-rejected":""},priorityIcon(){switch(this.task.priority){case"Низкий":return{icon:"mdi-arrow-down",color:"green"};case"Средний":return{icon:"mdi-scale-balance",color:"blue"};case"Важный":return{icon:"mdi-alert",color:"orange"};case"Очень важный":return{icon:"mdi-alert-circle",color:"red"};case"Бомба":return{icon:"mdi-bomb",color:"purple"};default:return{icon:"mdi-help-circle",color:"grey"}}}}},G=M,W=(0,T.A)(G,I,F,!1,null,"610266dd",null),Y=W.exports,Q=s(8230),q=s(4852),Z=s(7402),J=function(){var t=this,e=t._self._c;return e(V.A,{attrs:{"max-width":"600px",persistent:""},model:{value:t.localDialogOpen,callback:function(e){t.localDialogOpen=e},expression:"localDialogOpen"}},[e(N.A,[e(j.ri,[t.isEditMode?e("span",[t._v("Редактировать поручение")]):t.isReadonly?e("span",[t._v("Просмотр поручения")]):e("span",[t._v("Создать поручение")])]),e(j.OQ,[e(Q.A,{ref:"form",model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[e(C.A,{attrs:{label:"Тема",rules:[t=>!!t||"Тема обязательна"],readonly:t.isReadonly},model:{value:t.taskData.subject,callback:function(e){t.$set(t.taskData,"subject",e)},expression:"taskData.subject"}}),e(Z.A,{attrs:{label:"Текст документа","auto-grow":"",rows:10,rules:[t=>!!t||"Описание обязательно"],readonly:t.isReadonly},model:{value:t.taskData.description,callback:function(e){t.$set(t.taskData,"description",e)},expression:"taskData.description"}}),e(R.A,{staticClass:"d-flex justify-end"},[t.isRecording?e(q.A,{staticClass:"mt-2",attrs:{indeterminate:"",color:"primary"}}):t._e(),e(V.A,{attrs:{persistent:"","max-width":"290"},model:{value:t.isUploading,callback:function(e){t.isUploading=e},expression:"isUploading"}},[e(N.A,[e(j.OQ,{staticClass:"text-center"},[e(O.A,{attrs:{indeterminate:"",size:"68",width:"4",color:"primary"}}),e("div",[t._v(t._s(this.preloaderText))])],1)],1)],1),t.isReadonly?t._e():e(p.A,{attrs:{icon:""},on:{click:t.startVoiceRecording}},[t.isRecording?e(h.A,{attrs:{color:"primary"}},[t._v("mdi-microphone")]):e(h.A,[t._v("mdi-microphone-outline")])],1),t.isReadonly?t._e():e(p.A,{attrs:{icon:""},on:{click:t.fixTextErrors}},[e(h.A,[t._v("mdi-text-box-edit-outline")])],1)],1),e(L.A,{attrs:{items:t.statuses,label:"Статус",rules:[t=>!!t||"Статус обязателен"],readonly:t.isReadonly},model:{value:t.taskData.status,callback:function(e){t.$set(t.taskData,"status",e)},expression:"taskData.status"}}),e(L.A,{attrs:{items:t.priorities,label:"Приоритет",readonly:t.isReadonly},model:{value:t.taskData.priority,callback:function(e){t.$set(t.taskData,"priority",e)},expression:"taskData.priority"}}),e(C.A,{attrs:{label:"Дата создания",rules:[t=>!!t||"Дата создания обязательна"],type:"date",readonly:t.isReadonly},model:{value:t.taskData.registration_date,callback:function(e){t.$set(t.taskData,"registration_date",e)},expression:"taskData.registration_date"}}),e(L.A,{attrs:{items:t.users,"item-text":"name","item-value":"id",label:"Назначить на",required:"",readonly:t.isReadonly},model:{value:t.taskData.assignedTo,callback:function(e){t.$set(t.taskData,"assignedTo",e)},expression:"taskData.assignedTo"}})],1)],1),e(j.SL,[e(l.A),e(p.A,{attrs:{color:"blue darken-1",text:""},on:{click:t.close}},[t._v("Отмена")]),t.isReadonly?t._e():e(p.A,{attrs:{color:"blue darken-1",text:""},on:{click:t.save}},[t._v("Сохранить")])],1)],1)],1)},H=[],K=s(2835),X=s.n(K),tt={props:{isDialogOpen:Boolean,isReadonly:Boolean,isEditMode:Boolean,task:Object},data(){return{localDialogOpen:this.isDialogOpen,taskData:this.task||{assignedTo:null,subject:"",description:"",status:"",priority:"",registrationDate:"",recorder:null,audioBlob:null},statuses:["В обработке","Завершено","Отменено"],priorities:["Низкий","Средний","Важный","Очень важный","Бомба"],users:[],valid:!0,isRecording:!1,isUploading:!1,preloaderText:""}},watch:{isDialogOpen(t){this.localDialogOpen=t,t||this.isEditMode||this.isReadonly||this.resetForm()},task(t){this.taskData=t||{id:null,assignedTo:null,subject:"",description:"",status:"",priority:"",registration_date:""},this.taskData.assignedTo=t.responsible_employee_id;const e=new Date(t.registration_date);this.taskData.registration_date=e.toISOString().split("T")[0]}},mounted(){this.fetchUsers()},methods:{async fetchUsers(){try{const t=localStorage.getItem("access_token"),e=await z.A.get(`${{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_GATEWAY_URL}/auth/users`,{headers:{Authorization:`Bearer ${t}`}});this.users=e.data}catch(t){console.error("Ошибка при загрузке списка пользователей:",t)}},close(){this.localDialogOpen=!1,this.$emit("update:isDialogOpen",!1),this.isEditMode||this.isReadonly||this.resetForm()},async save(){this.preloaderText=this.isEditMode?"Сохранение изменений...":"Сохранение данных...",this.isUploading=!0;const t=localStorage.getItem("access_token");if(this.$refs.form.validate()){const s=this.isEditMode?`${{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_GATEWAY_URL}/documents-api/${this.taskData.id}`:`${{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_GATEWAY_URL}/documents-api/`,a=localStorage.getItem("user_id"),i={file_id:this.taskData.file_id||null,subject:this.taskData.subject||"",description:this.taskData.description||"",status:this.taskData.status||"",priority:this.taskData.priority||"",author_id:a||"",responsible_employee_id:this.taskData.assignedTo||"",registration_date:this.taskData.registration_date||(new Date).toISOString()};try{this.isEditMode?await z.A.put(s,i,{headers:{Authorization:`Bearer ${t}`}}):await z.A.post(s,i,{headers:{Authorization:`Bearer ${t}`}}),this.taskData.responsible_employee_id=this.taskData.assignedTo,this.$emit("save-task",this.taskData),this.isEditMode?this.$notify({group:"foo",type:"info",text:"Поручение обновлено"}):this.$notify({group:"foo",type:"success",text:"Поручение добавлено!"}),this.close()}catch(e){console.error("Ошибка при сохранении задачи:",e),this.$notify({group:"foo",type:"error",text:"Ошибка при сохранении поручения!"})}finally{this.isUploading=!1}}},async startVoiceRecording(){if(this.isRecording)this.recorder.stopRecording((async()=>{this.audioBlob=this.recorder.getBlob(),this.preloaderText="Расшифровка голосового сообщения...",this.isRecording=!1,this.isUploading=!0;const t=new FormData;t.append("file",this.audioBlob,"audio.webm");try{const e=localStorage.getItem("access_token");this.$notify({group:"foo",type:"info",text:"Транскрибация аудио началась"});const s=await z.A.post(`${{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_GATEWAY_URL}/transcribe-audio/`,t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${e}`}}),a=s.data.transcription;Array.isArray(a)?this.taskData.description=a[0]:this.taskData.description=a,Array.isArray(this.taskData.description)&&(this.taskData.description=this.taskData.description[0]),""==this.taskData.description?this.$notify({group:"foo",type:"warning",text:"Сервер перегружен или пустое сообщение... Повторите попытку"}):this.$notify({group:"foo",type:"success",text:"Текст успешно транскрибирован"})}catch(e){console.error("Ошибка при транскрибировании аудио:",e),this.$notify({group:"foo",type:"error",text:"Ошибка при транскрибировании аудио"})}finally{this.isUploading=!1}}));else try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});this.recorder=new(X())(t,{type:"audio",mimeType:"audio/webm",recorderType:X().MediaStreamRecorder,timeSlice:1e3}),this.recorder.startRecording(),this.isRecording=!0,this.$notify({group:"foo",type:"info",text:"Запись началась (Нажмите повторно для окончания)"})}catch(t){console.error("Ошибка при доступе к микрофону:",t),this.$notify({group:"foo",type:"error",text:"Ошибка при доступе к микрофону"})}},async fixTextErrors(){try{this.preloaderText="Проверка текста...",this.isUploading=!0;const t=localStorage.getItem("access_token"),e=await z.A.post(`${{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_GATEWAY_URL}/correct-text/`,{text:this.taskData.description},{headers:{Authorization:`Bearer ${t}`}});this.taskData.description=e.data.corrected_text[0],this.isUploading=!1,this.$notify({group:"foo",type:"success",text:"Текст успешно исправлен"})}catch(t){console.error("Ошибка при исправлении текста:",t),this.isUploading=!1,this.$notify({group:"foo",type:"error",text:"Ошибка при исправлении текста"})}},resetForm(){this.taskData={assignedTo:null,subject:"",description:"",status:"",priority:"",registrationDate:""}}}},et=tt,st=(0,T.A)(et,J,H,!1,null,"86d81492",null),at=st.exports,it={components:{TaskCard:Y,TaskForm:at},data(){return{activePanel:[1],userRole:"Специалист",assignedTasks:[],createdTasks:[],isTaskFormOpen:!1,isFormReadonly:!1,isEditMode:!1,isLoading:!0,currentTask:null,currentUser:null,users:[],searchQuery:"",filterStatus:null,filterPriority:null,statusOptions:["В обработке","Завершено","Отменено"],priorityOptions:["Низкий","Важный","Очень важный","Бомба"]}},created(){this.fetchUsers(),this.fetchUserData(),this.fetchTasks()},methods:{async fetchUsers(){try{const t=localStorage.getItem("access_token"),e=await z.A.get(`${{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_GATEWAY_URL}/auth/users`,{headers:{Authorization:`Bearer ${t}`}});this.users=e.data}catch(t){console.error("Ошибка при загрузке списка пользователей:",t)}},async fetchUserData(){try{const t=localStorage.getItem("access_token"),e=await fetch(`${{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_GATEWAY_URL}/auth/user`,{headers:{Authorization:`Bearer ${t}`}}),s=await e.json();this.currentUser=s,this.userRole=s.localized_role}catch(t){this.$notify({group:"foo",type:"error",text:"Ошибка при получении данных пользователя!"})}},async fetchTasks(){try{this.isLoading=!0;const t=localStorage.getItem("user_id"),e=localStorage.getItem("access_token"),s=await z.A.get(`${{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_GATEWAY_URL}/documents-api/assigned-tasks/${t}`,{headers:{Authorization:`Bearer ${e}`}}),a=await z.A.get(`${{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_GATEWAY_URL}/documents-api/created-tasks/${t}`,{headers:{Authorization:`Bearer ${e}`}});this.assignedTasks=200===s.status&&Array.isArray(s.data)?s.data:[],this.createdTasks=200===a.status&&Array.isArray(a.data)?a.data:[],this.$notify({group:"foo",type:"info",text:"Поручения успешно загружены"})}catch(t){t.response&&404===t.response.status?(console.warn("Задачи не найдены, установка пустых массивов."),this.assignedTasks=[],this.createdTasks=[]):(console.error("Ошибка при загрузке поручений:",t),this.$notify({group:"foo",type:"error",text:"Ошибка при загрузке поручений!"}))}finally{this.isLoading=!1}},openTaskForm(t,e,s=!1){this.isEditMode=t,this.currentTask=e,this.isTaskFormOpen=!0,this.isFormReadonly=s},updateTaskFormOpen(t){this.isTaskFormOpen=t},saveTask(t){if(this.isEditMode){const e=this.createdTasks.findIndex((t=>t.id===this.currentTask.id));-1!==e&&this.$set(this.createdTasks,e,{...this.currentTask,...t})}else{const e={...t,id:this.createdTasks.length+1};this.createdTasks.push(e)}this.fetchTasks()},async deleteTask(t){const e=localStorage.getItem("access_token");try{await z.A.delete(`${{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_GATEWAY_URL}/documents-api/${t.id}`,{headers:{Authorization:`Bearer ${e}`}}),this.createdTasks=this.createdTasks.filter((e=>e.id!==t.id)),this.$notify({group:"foo",type:"success",text:"Поручение удалено"}),this.fetchTasks()}catch(s){console.error("Ошибка при удалении задачи:",s),this.$notify({group:"foo",type:"error",text:"Ошибка при удалении поручения!"})}}},computed:{filteredAssignedTasks(){return this.assignedTasks.filter((t=>(!this.filterStatus||t.status===this.filterStatus)&&(!this.filterPriority||t.priority===this.filterPriority)&&(!this.searchQuery||t.subject.toLowerCase().includes(this.searchQuery.toLowerCase()))))},filteredCreatedTasks(){return this.createdTasks.filter((t=>(!this.filterStatus||t.status===this.filterStatus)&&(!this.filterPriority||t.priority===this.filterPriority)&&(!this.searchQuery||t.subject.toLowerCase().includes(this.searchQuery.toLowerCase()))))}}},ot=it,rt=(0,T.A)(ot,P,B,!1,null,"0853eeef",null),nt=rt.exports,lt=function(){var t=this,e=t._self._c;return e(U.A,{staticClass:"d-flex justify-center align-center fill-height"},[e(N.A,{staticClass:"pa-5",attrs:{outlined:"",rounded:""}},[e(Q.A,{ref:"loginForm",on:{submit:function(e){return e.preventDefault(),t.login.apply(null,arguments)}},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[e(C.A,{attrs:{label:"Логин",rules:[t.rules.required],required:""},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),e(C.A,{attrs:{label:"Пароль",type:"password",rules:[t.rules.required],required:""},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),e(p.A,{staticClass:"mt-4",attrs:{disabled:!t.valid,loading:t.loading},on:{click:t.login}},[t._v(" Войти ")])],1)],1)],1)},ct=[],dt={data(){return{valid:!1,username:"",password:"",loading:!1,rules:{required:t=>!!t||"Обязательное поле"}}},methods:{async login(){this.loading=!0;try{const t=await fetch(`${{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_GATEWAY_URL}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.username,password:this.password})}),e=await t.json();if(t.ok){const t=e.access_token;localStorage.setItem("access_token",t),this.$emit("login-success",t),this.$notify({group:"foo",type:"success",text:"Авторизация успешна!"})}else this.$notify({group:"foo",type:"error",text:"Ошибка авторизации!"})}catch(t){this.$notify({group:"foo",type:"error",text:"Ошибка сети!"})}finally{this.loading=!1}}}},ut=dt,pt=(0,T.A)(ut,lt,ct,!1,null,"3b782add",null),ht=pt.exports,gt={components:{UserMenu:D,TaskList:nt,LoginForm:ht},data(){return{isLoggedIn:!1,user:null}},methods:{async handleLoginSuccess(t){try{const e=await fetch(`${{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_GATEWAY_URL}/auth/user`,{headers:{Authorization:`Bearer ${t}`},mode:"cors"}),s=await e.json();this.user=s,localStorage.setItem("user_id",this.user.id),this.isLoggedIn=!0}catch(e){this.$notify({group:"foo",type:"error",text:"Ошибка при получении данных пользователя!"})}},async handleLogout(){const t=localStorage.getItem("access_token");try{await fetch(`${{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_GATEWAY_URL}/auth/logout`,{method:"GET",headers:{Authorization:`Bearer ${t}`}}),localStorage.removeItem("access_token"),this.user=null,this.isLoggedIn=!1,this.$notify({group:"foo",type:"success",text:"Вы вышли из аккаунта!"})}catch(e){this.$notify({group:"foo",type:"error",text:"Ошибка при выходе из аккаунта!"})}}}},ft=gt,_t=(0,T.A)(ft,d,u,!1,null,null,null),yt=_t.exports,kt=s(5453);a["default"].use(kt.A);var mt=new kt.A({}),At=s(410),vt=s.n(At);a["default"].config.productionTip=!1,a["default"].use(vt()),new a["default"]({vuetify:mt,render:t=>t(yt)}).$mount("#app")}},e={};function s(a){var i=e[a];if(void 0!==i)return i.exports;var o=e[a]={exports:{}};return t[a].call(o.exports,o,o.exports,s),o.exports}s.m=t,function(){var t=[];s.O=function(e,a,i,o){if(!a){var r=1/0;for(d=0;d<t.length;d++){a=t[d][0],i=t[d][1],o=t[d][2];for(var n=!0,l=0;l<a.length;l++)(!1&o||r>=o)&&Object.keys(s.O).every((function(t){return s.O[t](a[l])}))?a.splice(l--,1):(n=!1,o<r&&(r=o));if(n){t.splice(d--,1);var c=i();void 0!==c&&(e=c)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[a,i,o]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={524:0};s.O.j=function(e){return 0===t[e]};var e=function(e,a){var i,o,r=a[0],n=a[1],l=a[2],c=0;if(r.some((function(e){return 0!==t[e]}))){for(i in n)s.o(n,i)&&(s.m[i]=n[i]);if(l)var d=l(s)}for(e&&e(a);c<r.length;c++)o=r[c],s.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return s.O(d)},a=self["webpackChunktask_manager"]=self["webpackChunktask_manager"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],(function(){return s(9503)}));a=s.O(a)})();
//# sourceMappingURL=app.6a9e34df.js.map